<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rendimiento del Agente</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #ffffff;
    color: #033f1a;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #1b8c47;
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 1.8em;
    position: sticky;
    top: 0;
  }
  main {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    padding: 20px;
  }
  section {
    background: #f8fff9;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  section:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  h2 {
    border-left: 6px solid #1b8c47;
    padding-left: 10px;
    color: #033f1a;
  }
  canvas {
    width: 100% !important;
    height: 300px !important;
  }
  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    text-align: center;
  }
  .day {
    border: 1px solid #d6ecd9;
    padding: 10px;
    border-radius: 8px;
    transition: background 0.3s, transform 0.2s;
  }
  .day:hover {
    background-color: #d6f5d6;
    transform: scale(1.05);
  }
  .event {
    background-color: #1b8c47;
    color: white;
    border-radius: 6px;
    padding: 2px 4px;
    margin-top: 5px;
    font-size: 0.8em;
  }
  footer {
    text-align: center;
    padding: 15px;
    background-color: #1b8c47;
    color: white;
    margin-top: 30px;
  }
  .info-btn {
    background-color: #1b8c47;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .info-btn:hover {
    background-color: #146c36;
  }
  .tooltip {
    display: none;
    background: #033f1a;
    color: white;
    padding: 10px;
    border-radius: 6px;
    position: absolute;
    z-index: 10;
    width: 200px;
  }
</style>
</head>
<body>
<header>Rendimiento del Agente</header>

<main>
  <section>
    <h2>Resumen de Citas</h2>
    <canvas id="chartCitas"></canvas>
    <button class="info-btn" onclick="toggleTooltip('tooltip1')">ℹ️ Información</button>
    <div id="tooltip1" class="tooltip">Este gráfico muestra el número de citas atendidas por día.</div>
  </section>

  <section>
    <h2>Calendario de Citas</h2>
    <div id="calendar"></div>
  </section>
</main>

<footer>
  Contacto de asistencia: <strong>8123836266</strong>
</footer>

<script>
// === FUNCIONES UTILITARIAS ===
function parseDate(dateStr) {
  // Convierte "31/10/2025" a formato Date válido (dd/mm/yyyy -> yyyy-mm-dd)
  const [day, month, year] = dateStr.split("/");
  return new Date(`${year}-${month}-${day}`);
}

function toggleTooltip(id) {
  const tooltip = document.getElementById(id);
  tooltip.style.display = tooltip.style.display === "block" ? "none" : "block";
}

// === CARGA DEL ARCHIVO EXCEL ===
fetch('TESTDB.xlsx')
  .then(res => res.arrayBuffer())
  .then(ab => {
    const data = new Uint8Array(ab);
    const workbook = XLSX.read(data, { type: "array" });
    const sheetName = workbook.SheetNames[0];
    const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

    // === PROCESAR DATOS ===
    const citasPorFecha = {};
    const citas = [];

    sheet.forEach(row => {
      const fecha = parseDate(row.fecha_cita);
      const fechaKey = fecha.toISOString().split("T")[0];
      citas.push({ fecha, servicio: row.servicio_motivo });
      citasPorFecha[fechaKey] = (citasPorFecha[fechaKey] || 0) + 1;
    });

    // === GRAFICAR ===
    const labels = Object.keys(citasPorFecha).sort();
    const values = labels.map(l => citasPorFecha[l]);

    new Chart(document.getElementById('chartCitas'), {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Citas atendidas',
          data: values,
          backgroundColor: '#1b8c47'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } }
      }
    });

    // === CREAR CALENDARIO ===
    crearCalendario(citas);
  });

// === FUNCION PARA MOSTRAR EL CALENDARIO ===
function crearCalendario(citas) {
  const contenedor = document.getElementById("calendar");
  contenedor.innerHTML = "";

  const hoy = new Date();
  const mes = hoy.getMonth();
  const anio = hoy.getFullYear();

  const primerDia = new Date(anio, mes, 1);
  const ultimoDia = new Date(anio, mes + 1, 0);
  const diasEnMes = ultimoDia.getDate();

  // Espacios vacíos antes del primer día
  for (let i = 0; i < primerDia.getDay(); i++) {
    contenedor.appendChild(document.createElement("div"));
  }

  for (let dia = 1; dia <= diasEnMes; dia++) {
    const fechaActual = new Date(anio, mes, dia);
    const fechaKey = fechaActual.toISOString().split("T")[0];
    const div = document.createElement("div");
    div.classList.add("day");
    div.innerHTML = `<strong>${dia}</strong>`;

    citas.forEach(c => {
      const fKey = c.fecha.toISOString().split("T")[0];
      if (fKey === fechaKey) {
        const event = document.createElement("div");
        event.classList.add("event");
        event.textContent = c.servicio || "Cita";
        div.appendChild(event);
      }
    });

    contenedor.appendChild(div);
  }
}
</script>
</body>
</html>
